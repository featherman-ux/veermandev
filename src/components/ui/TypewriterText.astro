---
export interface Props {
  words: string[];
  className?: string;
  initialText?: string;
  cursorClass?: string;
}

const { words, className = "text-primary", initialText, cursorClass = "terminal-cursor" } = Astro.props;
---

<span 
  class={`typewriter-text ${className} inline-block text-center`} 
  data-words={JSON.stringify(words)}
  data-cursor-class={cursorClass}
>
  {initialText || words[0]}
</span>

<style>
  .typewriter-text {
    min-height: 1.2em;
    display: inline-block;
    vertical-align: top;
  }
  
  .terminal-cursor {
    animation: blink 1s infinite;
    color: currentColor;
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }
  
  /* Mobile responsive styles */
  @media (max-width: 640px) {
    .typewriter-text {
      max-width: 100%;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const typewriterElements = document.querySelectorAll('.typewriter-text') as NodeListOf<HTMLElement>;
    
    typewriterElements.forEach((typewriterElement) => {
      if (typewriterElement) {
        const words = JSON.parse(typewriterElement.dataset.words || '[]');
        const cursorClass = typewriterElement.dataset.cursorClass || 'terminal-cursor';
        let currentWordIndex = 0;
        let currentCharIndex = 0;
        let isDeleting = false;
        let isWaiting = false;

        function typeWriter() {
          const currentWord = words[currentWordIndex];
          const shouldDelete = isDeleting;
          const shouldWait = isWaiting;

          if (shouldWait) {
            setTimeout(() => {
              isWaiting = false;
              typeWriter();
            }, 2000);
            return;
          }

          if (shouldDelete) {
            if (currentCharIndex > 0) {
              currentCharIndex--;
              typewriterElement.innerHTML = currentWord.substring(0, currentCharIndex) + `<span class="${cursorClass}">|</span>`;
              setTimeout(typeWriter, 75);
            } else {
              isDeleting = false;
              currentWordIndex = (currentWordIndex + 1) % words.length;
              setTimeout(typeWriter, 200);
            }
          } else {
            if (currentCharIndex < currentWord.length) {
              currentCharIndex++;
              typewriterElement.innerHTML = currentWord.substring(0, currentCharIndex) + `<span class="${cursorClass}">|</span>`;
              setTimeout(typeWriter, 150);
            } else {
              isWaiting = true;
              setTimeout(() => {
                isDeleting = true;
                isWaiting = false;
                typeWriter();
              }, 3000);
            }
          }
        }

        // Start typewriter effect after a delay
        setTimeout(typeWriter, 1500);
      }
    });
  });
</script>